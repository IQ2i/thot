{% set uniqid = random() %}

<div>
    <div class="flex justify-between items-center w-full text-xs/6 font-semibold text-gray-500 dark:text-gray-400">
        {{ 'conversation.title'|trans }}
        <button command="show-modal" commandfor="dialog">
            <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
            </svg>
        </button>
    </div>

    <ul role="list" class="-mx-2 mt-2 space-y-1">
        {% for project in projects %}
            <li>
                <button type="button" command="--toggle" commandfor="sub-menu-{{ uniqid }}-{{ project.id }}" aria-expanded="{% if project.opened %}true{% else %}false{% endif %}" class="flex w-full items-center gap-x-3 rounded-md p-2 text-left text-sm/6 font-semibold text-gray-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-white/5">
                    <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5 shrink-0 not-in-aria-expanded:text-gray-400 in-aria-expanded:rotate-90 in-aria-expanded:text-gray-500 dark:in-aria-expanded:text-gray-400">
                        <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                    </svg>
                    {{ project.name }}
                </button>
                <el-disclosure id="sub-menu-{{ uniqid }}-{{ project.id }}" {% if project.opened %}open{% else %}hidden{% endif %} class="contents">
                    <ul class="mt-1 px-2">
                        {% for conversation in project.conversations %}
                            <li class="{{ html_classes('flex justify-between items-center', {
                                'bg-gray-100 dark:bg-white/5': conversation.active,
                                'hover:bg-gray-100 dark:hover:bg-white/5': not conversation.active,
                            }) }}">
                                <a href="{{ path('app_conversation_detail', {id: conversation.id}) }}" id="conversation-name-{{ conversation.id }}" class="{{ html_classes('block rounded-md py-2 pr-2 pl-9 text-sm/6 text-gray-700 dark:text-gray-400 truncate', {
                                    'text-indigo-600 dark:text-white': conversation.active,
                                    'text-gray-700 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-white': not conversation.active,
                                }) }}">
                                    {{ conversation.name }}
                                </a>

                                <el-dropdown class="inline-block">
                                    <button class="flex items-center rounded-full text-gray-400 hover:text-gray-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:text-gray-400 dark:hover:text-gray-300 dark:focus-visible:outline-indigo-500">
                                        <span class="sr-only">{{ 'menu.open_options'|trans }}</span>
                                        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                            <path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                                        </svg>
                                    </button>

                                    <el-menu anchor="bottom end" popover class="w-56 origin-top-right rounded-md bg-white shadow-lg outline-1 outline-black/5 transition transition-discrete [--anchor-gap:--spacing(2)] data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in dark:bg-gray-800 dark:shadow-none dark:-outline-offset-1 dark:outline-white/10">
                                        <div class="py-1">
                                            <a href="{{ path('app_conversation_edit', {id: conversation.id}) }}" class="block px-4 py-2 text-sm text-gray-700 focus:bg-gray-100 focus:text-gray-900 focus:outline-hidden dark:text-gray-300 dark:focus:bg-white/5 dark:focus:text-white">{{ 'action.edit'|trans }}</a>
                                            <a href="{{ path('app_conversation_delete', {id: conversation.id}) }}" class="block px-4 py-2 text-sm text-gray-700 focus:bg-gray-100 focus:text-gray-900 focus:outline-hidden dark:text-gray-300 dark:focus:bg-white/5 dark:focus:text-white">{{ 'action.delete'|trans }}</a>
                                        </div>
                                    </el-menu>
                                </el-dropdown>
                            </li>
                        {% endfor %}
                    </ul>
                </el-disclosure>
            </li>
        {% endfor %}
    </ul>
</div>
